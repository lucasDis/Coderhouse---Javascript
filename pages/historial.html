<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historial de Recetas - Ingrediente Cero</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/flowbite@2.3.0/dist/flowbite.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="../css/styles.css?v=2.1.1">
  <script defer src="../js/data.js?v=2.1.1"></script>
  <script defer src="../js/storage.js?v=2.1.1"></script>
  <script defer src="../js/ui.js?v=2.1.1"></script>
  <script defer src="../js/history.js?v=2.1.1"></script>
</head>

<body>
  <header class="header">
    <div class="header-container">
      <div class="logo">
        <h1>Ingrediente Cero</h1>
      </div>
      <nav class="nav">
        <a href="../index.html" class="nav-link">Inicio</a>
        <a href="generar-receta.html" class="nav-link">Generar Receta</a>
        <a href="historial.html" class="nav-link active">Historial</a>
        <a href="libros.html" class="nav-link">Libros</a>
        <div class="cart-icon" id="cartIcon">
          🛒
          <span class="cart-count" id="cartCount">0</span>
        </div>
      </nav>
    </div>
  </header>

  <main class="main">
    <section class="history-section">
      <div class="container">
        <div class="history-header">
          <h2>Tu Historial de Recetas</h2>
          <p>Todas las recetas que has generado y guardado</p>
          <div class="history-actions">
            <button class="btn-primary" id="btnNuevaReceta">Nueva Receta</button>
            <button class="btn-secondary" id="btnEstadisticas">📊 Ver Estadísticas</button>
            <button class="btn-secondary btn-export-disabled" id="btnExportar" disabled>💾 Exportar</button>
            <button class="btn-secondary btn-export-disabled" id="btnLimpiarHistorial" disabled>🗑️ Limpiar Todo</button>
          </div>
        </div>
      </div>

      <div class="history-content">
        <div class="history-filters">
          <div class="filter-group">
            <label for="filterSearch">Buscar:</label>
            <input type="text" id="filterSearch" placeholder="Nombre o ingrediente...">
          </div>

          <div class="filter-group">
            <label for="sortBy">Ordenar por:</label>
            <select id="sortBy">
              <option value="date">Más reciente</option>
              <option value="name">Nombre</option>
              <option value="style">Estilo</option>
              <option value="rating">Mejor calificadas</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="filterStyle">Filtrar por estilo:</label>
            <select id="filterStyle">
              <option value="">Todos</option>
              <option value="Mediterráneo">Mediterráneo</option>
              <option value="Asiático">Asiático</option>
              <option value="Mexicano">Mexicano</option>
              <option value="Italiano">Italiano</option>
              <option value="Casero">Casero</option>
              <option value="Gourmet">Gourmet</option>
              <option value="Picante">Picante</option>
              <option value="Dulce">Dulce</option>
              <option value="Tradicional">Tradicional</option>
              <option value="Fusión">Fusión</option>
            </select>
          </div>

          <div class="filter-group filter-checkbox">
            <label>
              <input type="checkbox" id="filterFavorites">
              Solo Favoritos ⭐
            </label>
          </div>
        </div>

        <div class="recipe-count-container">
          <p id="recipeCount" class="recipe-count">0 recetas encontradas</p>
        </div>
      </div>

  
      <div class="recipes-grid" id="historyGrid">
      </div>

      <div class="empty-history" id="emptyHistory" style="display: none;">
        <div class="empty-icon">📚</div>
        <h3>No hay recetas en tu historial</h3>
        <p>Comienza a generar y guardar tus recetas favoritas</p>
        <a href="generar-receta.html" class="btn-primary">Generar Primera Receta</a>
      </div>
      </div>
      </div>
    </section>
  </main>

  <div class="modal" id="recipeModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalRecipeTitle">Detalles de la Receta</h3>
        <span class="close" id="btnCerrarModal">&times;</span>
      </div>
      <div class="modal-body" id="modalRecipeContent">
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.3.0/dist/flowbite.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Sistema de versionamiento - PRIMERO -->
  <script src="../js/version.js?v=2.1.1"></script>
  <script>
    // FORZAR LIMPIEZA DE CACHÉ - VERSIÓN 2.1.1
    if (localStorage.getItem('app_version') !== '2.1.1') {
      console.log('Forzando limpieza de caché...');
      localStorage.clear();
      sessionStorage.clear();
      localStorage.setItem('app_version', '2.1.1');
      window.location.reload(true);
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('Historial cargado - Versión 2.1.1');

      // Actualizar contador del carrito
      const carritoCount = document.getElementById('cartCount');
      if (carritoCount) {
        const carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
        const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);
        carritoCount.textContent = totalItems;
      }

      // Event listener para icono del carrito
      const cartIcon = document.getElementById('cartIcon');
      if (cartIcon) {
        cartIcon.addEventListener('click', () => {
          window.location.href = 'carrito.html';
        });
      }
    });
  </script>
</body>

</html>